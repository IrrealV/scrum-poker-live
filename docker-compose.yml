services:
  # ---------------------------------------------------------------------------
  # FRONTEND (Next.js)
  # ---------------------------------------------------------------------------
  web:
    container_name: scrum-poker-web
    build:
      context: .              # IMPORTANTE: Contexto en la raíz del monorepo
      dockerfile: apps/web/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - HOSTNAME=0.0.0.0
      # URL de la API para conexiones desde el cliente (WebSocket)
      - NEXT_PUBLIC_API_URL=http://localhost:4000
    depends_on:
      - api
    restart: always

  # ---------------------------------------------------------------------------
  # BACKEND (NestJS API)
  # ---------------------------------------------------------------------------
  api:
    container_name: scrum-poker-api
    build:
      context: .              # IMPORTANTE: Contexto en la raíz también
      dockerfile: apps/api/Dockerfile
    ports:
      - "4000:4000"
    environment:
      - PORT=4000
      - HOSTNAME=0.0.0.0
      - CORS_ORIGIN=http://localhost:3000  # Permitir conexiones solo desde el front
    restart: always

# (Opcional) Si usaras base de datos, iría aquí abajo como otro servicio (db)